name: CI Pipline

on: [push]

jobs:
  # push_to_docker_registry:
  #   name: Push Docker image to Docker Hub
  #   runs-on: ubuntu-24.04
  #   steps:
  #     - name: Check out the repo
  #       uses: actions/checkout@v6
      
  #     - name: Log in to Docker Hub 
  #       uses: docker/login-action@v3
  #       with: 
  #         username: ${{secrets.DOCKER_USERNAME}}
  #         password: ${{secrets.DOCKER_PASSWORD}}
          
  #     - name: Extract metadata (tags, labels) for Docker
  #       id: meta
  #       uses: docker/metadata-action@v5
  #       with:
  #         images: ranitzahak/test_web_app

  #     - name: Build and push Docker image
  #       uses: docker/build-push-action@v6
  #       with:
  #         context: .
  #         push: true
  #         tags: ${{steps.meta.outputs.tags}}
  #         labels: ${{steps.meta.outputs.labels}}

  build: 
    name: Build Docker image to Push Docker Hub
    runs-on: ubuntu-24.04
    steps:
      - name: Check out the repo
        uses: actions/checkout@v3
      
      # - name: Set up Docker Buildx
      #   uses: docker/setup-buildx-action@v3
      
      - name: Create a text file and write content
        run: echo "Build Docker image to Push Docker Hub"
  security-check:
    runs-on: self-hosted
    needs: [build]
    steps:
    - name: Trivy Installation
      run: print("Trivy FS Scan...")
      shell: python

  test: #GitHub-List-all-repo-files:
    runs-on: ubuntu-24.04
    steps:
      
      - name: Checkout Repo
        uses: actions/checkout@v6 #The command uses: actions/checkout@v4 (or v6) is the act of downloading your code from the GitHub servers onto that virtual machine.

      - name: Executing Shell Script
        run: |
          chmod +x example_shell_script.sh
          ./example_shell_script.sh

  deploy: #Linux-List-all-files: 
    
    runs-on: ubuntu-24.04
    steps:
      - name: Create a text file and write content
        run: echo "Hello text!" > filename.txt

      - name: List all files in the virtual machine (Linux/macOS)
        run:  |
          pwd
          ls  -ltra && cat filename.txt

  # security-check:
  #   runs-on: self-hosted
  #   # needs: [job-build, job-test, job-deploy]

  #   steps:
  #   - uses: actions/checkout@v4
  #   - name: Trivy Installation
  #     run: |
  #       sudo apt-get install -y wget apt-transport-https gnupg lsb-release
  #       wget -qO - https://aquasecurity.github.io/trivy-repo/deb/public.key | sudo apt-key add -
  #       echo deb https://aquasecurity.github.io/trivy-repo/deb $(lsb_release -sc) main | sudo tee -a /etc/apt/sources.list.d/trivy.list
  #       sudo apt-get update -y
  #       sudo apt-get install -y trivy

  #   - name: Trivy FS Scan
  #     run: trivy fs --format table -o fs-report.json .

  #   - name: Gitleaks Installation
  #     run: sudo apt install gitleaks -y
  #   - name: Gitleaks Code Scan
  #     run: gitleaks detect source . -r gitleaks-report.json -f json
    
    
  #   - name: job-complete-python-shell-script
  #     run: print("A jobs of Build, Test and Deploy is complete! (execut by python shell script)")
  #     shell: python